<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<title>DBWTL Programmers Guide</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}


@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

pre.verseblock-content {
  font-family: inherit;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(3);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>DBWTL Programmers Guide</h1>
<span id="author">Daniel Vogelbacher</span><br />
<span id="email"><tt>&lt;<a href="mailto:daniel@vogelbacher.name">daniel@vogelbacher.name</a>&gt;</tt></span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<h1 id="_user_guide">USER GUIDE</h1>
<div class="paragraph"><p>The DBWTL library is a wrapper around database management system APIs. It
provides an uniform interface to all components and supports database specific
features.</p></div>
<div class="paragraph"><p>This manual describes how you can use the Informave DBWTL library.</p></div>
<h2 id="_introduction_with_a_step_by_step_example">1. Introduction with a step by step example</h2>
<div class="sectionbody">
<div class="paragraph"><p>All important declarations are provided by the inclusion of the
<em>dbobjects</em> header file.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;dbwtl/dbobjects&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>You have to choose at least one engine and include them.
If you want a generic API instead of a specific engine, you
can just include the <em>generic</em> engine.
The generic engine allows the configuration of a
specific engine at runtime.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;dbwtl/dal/engines/sqlite&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>The next line is not required, but makes life easier.
All needed classes are declared inside the <em>informave::db</em> namespace.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">using</span></span> <span style="font-weight: bold"><span style="color: #0000FF">namespace</span></span> informave<span style="color: #990000">::</span>db<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>Now we have to declare our own type to tell the dbwtl library
which database/engine we want to use.
The <em>Database</em> template members declares the right types for connections,
resultsets etc. depending on the given engine.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> Database<span style="color: #990000">&lt;</span>dal<span style="color: #990000">::</span>sqlite<span style="color: #990000">&gt;</span> DBMS<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>The environment is the first thing we have to create. The argument to the
constructor tells the environment which backend should be used.
For example, you can connect to a SQLite database via the libsqlite.dll C-Library,
through ODBC or ADO.</p></div>
<div class="paragraph"><p>If you are using the generic engine, the first part of the string is important.
The generic Environment class instantiates an environment of the given
engine "in the background". This makes it possible to select
the used engine at runtime.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DBMS<span style="color: #990000">::</span>Environment <span style="font-weight: bold"><span style="color: #000000">env</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"sqlite:libsqlite"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Now we can check if everything is correct and the dbwtl library
is correctly installed.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>gcc -o dbtest dbtest<span style="color: #990000">.</span>c -ldbwtl</tt></pre></div></div>
<h3 id="_creating_a_connection">1.1. Creating a connection</h3><div style="clear:left"></div>
<div class="paragraph"><p>In the next step, we create a new connection to a SQLite database.
The <em>Connection</em> constructor takes the environment object as a reference.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DBMS<span style="color: #990000">::</span>Connection <span style="font-weight: bold"><span style="color: #000000">dbc</span></span><span style="color: #990000">(</span>env<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Now we can open the database:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>dbc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span>L<span style="color: #FF0000">"sampledb.sqlitedb"</span><span style="color: #990000">);</span>
std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> i18n<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">conv_to</span></span><span style="color: #990000">(</span>dbc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dbmsName</span></span><span style="color: #990000">(),</span> <span style="color: #FF0000">"ISO-8859-1"</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span></tt></pre></div></div>
<h3 id="_run_a_sql_query">1.2. Run a SQL query</h3><div style="clear:left"></div>
<div class="paragraph"><p>To run a query, we need to create a Statement object.
The constructor takes the connection object as a reference.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DBMS<span style="color: #990000">::</span>Statement <span style="font-weight: bold"><span style="color: #000000">stmt</span></span><span style="color: #990000">(</span>dbc<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>The direct execution of a SQL statement is possible via <em>execDirect()</em>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execDirect</span></span><span style="color: #990000">(</span>L<span style="color: #FF0000">"SELECT * from customers"</span><span style="color: #990000">);</span></tt></pre></div></div>
<h4 id="_iterate_over_the_resultset">1.2.1. Iterate over the resultset</h4>
<div class="paragraph"><p>After execution of the statement, you can create a new DBMS::Resultset object
and attach it to the internal statement resultset:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>DBMS::Resultset rs(stmt);</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If the statement contains no internal resultset, the DBMS::Resultset
object is marked as <em>bad</em>. This state can only be changed by re-attaching
the statement via <em>rs.attach(stmt)</em>.</td>
</tr></table>
</div>
<div class="paragraph"><p>With the methods <em>first()</em>, <em>next()</em> and <em>eof()</em> you can iterate over the
records.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">for</span></span><span style="color: #990000">(</span>rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">first</span></span><span style="color: #990000">();</span> <span style="color: #990000">!</span>rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">eof</span></span><span style="color: #990000">();</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">next</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span> <span style="font-style: italic"><span style="color: #9A1900">//for each record }</span></span></tt></pre></div></div>
<h4 id="_access_the_record_fields">1.2.2. Access the record fields</h4>
<div class="paragraph"><p>You can access the fields by name or by position (first field has position 1).
To determine the number of available fields, use <em>columnCount()</em>.
The <em>column()</em> method returns a <em>const DBMS::Value</em> reference which provides
many getter methods like <em>asWideStr()</em>, <em>asInt()</em> or <em>asDate()</em> to get the value.
To check if a field is null, call isNull() on the value reference.</p></div>
<div class="listingblock">
<div class="title">Print all records and fields</div>
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">for</span></span><span style="color: #990000">(</span>rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">first</span></span><span style="color: #990000">();</span> <span style="color: #990000">!</span>rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">eof</span></span><span style="color: #990000">();</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">next</span></span><span style="color: #990000">())</span>
<span style="color: #FF0000">{</span>
 <span style="font-weight: bold"><span style="color: #0000FF">for</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;=</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">columnCount</span></span><span style="color: #990000">();</span> <span style="color: #990000">++</span>i<span style="color: #990000">)</span>
     <span style="color: #FF0000">{</span>
     <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">column</span></span><span style="color: #990000">(</span>i<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">isNull</span></span><span style="color: #990000">())</span>
         std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"&lt;NULL&gt;"</span><span style="color: #990000">;</span>
     <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
         std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">column</span></span><span style="color: #990000">(</span>i<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">asStr</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"UTF-8"</span><span style="color: #990000">);</span>
 <span style="color: #FF0000">}</span>
 std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<h4 id="_access_the_column_descriptor">1.2.3. Access the column descriptor</h4>
<div class="paragraph"><p>The <em>describeColumn()</em> method provides a getter for all column descriptors.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">for</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;=</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">columnCount</span></span><span style="color: #990000">();</span> i<span style="color: #990000">++)</span>
<span style="color: #FF0000">{</span>
     <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> DBMS<span style="color: #990000">::</span>ColumnDesc <span style="color: #990000">&amp;</span>desc <span style="color: #990000">=</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">describeColumn</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
     std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> desc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">catalogName</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
     std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> desc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">columnName</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>A DMBS::ColumnDesc (Interface: <em>dal::IColumnDesc</em>) object has
several getter methods all returning
a const DBMS::Variant (Interface: <em>dal::IVariant</em>) reference.</p></div>
</div>
<h2 id="_supported_database_systems_and_drivers">2. Supported database systems and drivers</h2>
<div class="sectionbody">
<h3 id="_sqlite">2.1. SQLite</h3><div style="clear:left"></div>
<div class="dlist"><dl>
<dt class="hdlist1">
libsqlite
</dt>
<dd>
<p>
Uses the libsqlite3.so or sqlite3.dll to access
a database file.
</p>
</dd>
<dt class="hdlist1">
odbc
</dt>
<dd>
<p>
Uses a installed ODBC driver to connect to a SQLite database.
</p>
</dd>
</dl></div>
</div>
<h2 id="_the_database_lt_gt_template">3. The Database&lt;&gt; template</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <em>Database&lt;&gt;</em> template defines all important types required to work
with a database, depending on the selected engine.
The engine is a class name from the <em>dal</em> namespace, e.g. <em>dal::sqlite</em>.
If you want to choose the engine at runtime, you can use <em>dal::generic</em> and
set the engine later.</p></div>
<h3 id="_handles">3.1. Handles</h3><div style="clear:left"></div>
<div class="paragraph"><p>There are three handles: Environment, Connection and Statement.</p></div>
<h4 id="_setting_options_for_handles">3.1.1. Setting options for handles</h4>
<div class="paragraph"><p>Each handle provides a <em>setOption()</em> and <em>getOption()</em> method.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DBMS<span style="color: #990000">::</span>Environment <span style="font-weight: bold"><span style="color: #000000">env</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"sqlite:libsqlite"</span><span style="color: #990000">);</span>

env<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setOption</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"env_library_path"</span><span style="color: #990000">,</span> std<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">wstring</span></span><span style="color: #990000">(</span>L<span style="color: #FF0000">"/path/to/libs"</span><span style="color: #990000">));</span>

std<span style="color: #990000">::</span>string path <span style="color: #990000">=</span> ifnull<span style="color: #990000">&lt;</span>std<span style="color: #990000">::</span>string<span style="color: #990000">&gt;(</span>env<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOption</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"env_library_path"</span><span style="color: #990000">),</span> <span style="color: #FF0000">"."</span><span style="color: #990000">);</span></tt></pre></div></div>
<h3 id="_environment">3.2. Environment</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>Database<span style="color: #990000">&lt;</span>dal<span style="color: #990000">::</span>engine_name<span style="color: #990000">&gt;::</span>Environment</tt></pre></div></div>
<h3 id="_connection">3.3. Connection</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>Database<span style="color: #990000">&lt;</span>dal<span style="color: #990000">::</span>engine_name<span style="color: #990000">&gt;::</span>Connection</tt></pre></div></div>
<h3 id="_statement">3.4. Statement</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>Database<span style="color: #990000">&lt;</span>dal<span style="color: #990000">::</span>engine_name<span style="color: #990000">&gt;::</span>Statement</tt></pre></div></div>
<h4 id="_binding_blob_and_memo_types">3.4.1. Binding BLOB and MEMO types</h4>
<div class="paragraph"><p>A DBMS::Statement object provides two overloaded bind() methods for
std::streambuf* and std::wstreambuf*.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Binding std::streambuf*
</dt>
<dd>
<p>
The data is threated as binary data.
</p>
</dd>
<dt class="hdlist1">
Binding std::wstreambuf*
</dt>
<dd>
<p>
A character set conversion is performed (from UCS-2 or UCS-4 to connection encoding)
before the data is sent to the database.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The following examples shows how stream buffers can be bound to a statement:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>std<span style="color: #990000">::</span>ifstream <span style="font-weight: bold"><span style="color: #000000">binFile</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"photo.jpg"</span><span style="color: #990000">,</span> std<span style="color: #990000">::</span>ios<span style="color: #990000">::</span>binary<span style="color: #990000">);</span>
stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> binFile<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rdbuf</span></span><span style="color: #990000">());</span> <span style="font-style: italic"><span style="color: #9A1900">// binary data</span></span>

std<span style="color: #990000">::</span>wifstream <span style="font-weight: bold"><span style="color: #000000">textFile</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"example.txt"</span><span style="color: #990000">);</span>
stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> textFile<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rdbuf</span></span><span style="color: #990000">());</span> <span style="font-style: italic"><span style="color: #9A1900">// text data</span></span>

std<span style="color: #990000">::</span>ifstream <span style="font-weight: bold"><span style="color: #000000">utf8File</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"utf8.txt"</span><span style="color: #990000">);</span>
std<span style="color: #990000">::</span>wstreambuf <span style="color: #990000">*</span>wbuf <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> std<span style="color: #990000">::</span>wbuffer_convert<span style="color: #990000">&lt;</span>std<span style="color: #990000">::</span>codecvt_utf8<span style="color: #990000">&gt;(</span>utf8File<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rdbuf</span></span><span style="color: #990000">());</span>
stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">,</span> wbuf<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">// text data</span></span></tt></pre></div></div>
<div class="paragraph"><p>The last one is a special case where a char stream buffer is first converted
to a wide char stream buffer.</p></div>
<h3 id="_resultset">3.5. Resultset</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>Database<span style="color: #990000">&lt;</span>dal<span style="color: #990000">::</span>engine_name<span style="color: #990000">&gt;::</span>Resultset</tt></pre></div></div>
<h4 id="_wokring_with_blob_and_memo_types">3.5.1. Wokring with BLOB and MEMO types</h4>
<div class="paragraph"><p>For receiving BLOB or MEMO fields, the Variant class provides two
methods: <em>asBlob()</em> and <em>asMemo()</em>.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
asBlob
</dt>
<dd>
<p>
Returns a pointer to std::streambuf and performs no charset conversion.
You just get the raw data from the database.
</p>
</dd>
<dt class="hdlist1">
asMemo
</dt>
<dd>
<p>
Returns a pointer to a std::wstreambuf and performs charset conversion (from
connection encoding to UCS-2 or UCS-4 [depends on sizeof(wchar_t]).
If the underlaying column type is of type BLOB (Variant::daltype() == <em>DAL_TYPE_BLOB</em>),
a convert_error exception is raised.
All other types are converted into a std::wstreambuf.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>If you have obtained a buffer pointer with asBlob() or asMemo(), the pointer
is valid (for all rows) until you close the resultset or statement.
Scrolling through the dataset (e.g. next()) only resets the buffer to the new
row data. If the new field is NULL, the buffer is marked as bad (std::ios::bad).</p></div>
<h3 id="_general_supported_types">3.6. General supported types</h3><div style="clear:left"></div>
<div class="paragraph"><p>The <em>Database&lt;&gt;</em> template provides for every selected engine a basic set
of types conforming to the SQL standard. An engine can extend this set
with system specific types supported by the database.</p></div>
<div class="tableblock">
<table rules="none"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="308" />
<col width="262" />
<tbody valign="top">
  <tr>
    <td align="left">
    <strong>SQL:2008 Type</strong>
    </td>
    <td align="left">
    <strong>DBWTL Type Mapping</strong>
    </td>
  </tr>
  <tr>
    <td align="left">
    CHARACTER
    </td>
    <td align="left">
    DBMS::Char
    </td>
  </tr>
  <tr>
    <td align="left">
    CHARACTER VARING
    </td>
    <td align="left">
    DBMS::Char
    </td>
  </tr>
  <tr>
    <td align="left">
    CHARACTER LARGE OBJECT
    </td>
    <td align="left">
    DBMS::Memo
    </td>
  </tr>
  <tr>
    <td align="left">
    BINARY
    </td>
    <td align="left">
    DBMS::Blob
    </td>
  </tr>
  <tr>
    <td align="left">
    BINARY VARYING
    </td>
    <td align="left">
    DBMS::Blob
    </td>
  </tr>
  <tr>
    <td align="left">
    BINARY LARGE OBJECT
    </td>
    <td align="left">
    DBMS::Blob
    </td>
  </tr>
  <tr>
    <td align="left">
    NUMERIC
    </td>
    <td align="left">
    DBMS::Numeric
    </td>
  </tr>
  <tr>
    <td align="left">
    DECIMAL
    </td>
    <td align="left">
    DBMS::Numeric
    </td>
  </tr>
  <tr>
    <td align="left">
    SMALLINT
    </td>
    <td align="left">
    DBMS::Smallint
    </td>
  </tr>
  <tr>
    <td align="left">
    INTEGER
    </td>
    <td align="left">
    DBMS::Integer
    </td>
  </tr>
  <tr>
    <td align="left">
    BIGINT
    </td>
    <td align="left">
    DBMS::Bigint
    </td>
  </tr>
  <tr>
    <td align="left">
    FLOAT
    </td>
    <td align="left">
    DBMS::Float
    </td>
  </tr>
  <tr>
    <td align="left">
    REAL
    </td>
    <td align="left">
    DBMS::Float
    </td>
  </tr>
  <tr>
    <td align="left">
    DOUBLE PRECISION
    </td>
    <td align="left">
    DBMS::Double
    </td>
  </tr>
  <tr>
    <td align="left">
    BOOLEAN
    </td>
    <td align="left">
    DBMS::Boolean
    </td>
  </tr>
  <tr>
    <td align="left">
    DATE
    </td>
    <td align="left">
    DBMS::Date
    </td>
  </tr>
  <tr>
    <td align="left">
    TIME
    </td>
    <td align="left">
    DBMS::Time
    </td>
  </tr>
  <tr>
    <td align="left">
    TIMESTAMP
    </td>
    <td align="left">
    DBMS::Timestamp
    </td>
  </tr>
  <tr>
    <td align="left">
    INTERVAL
    </td>
    <td align="left">
    unsupported
    </td>
  </tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Values from resultsets are automatically converted to the variable type.
So the following statement ist valid:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> DBMS<span style="color: #990000">::</span>Numeric val <span style="color: #990000">=</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">column</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">// auto conversion</span></span></tt></pre></div></div>
<h3 id="_value">3.7. Value</h3><div style="clear:left"></div>
<div class="paragraph"><p>The <em>Value</em> type is for column values returned from the engine. You can&#8217;t create
new objects of type <em>Value</em>, you can only get (mostly const) references
from a <em>Resultset</em> object.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> DBMS<span style="color: #990000">::</span>Value <span style="color: #990000">&amp;</span>val <span style="color: #990000">=</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">column</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>It is a requirement that the <em>Value</em> type implements the IVariant interface.
This allows you to pass column values to all methods which  accepts IVariant references,
for example Statement::bind()</p></div>
<h3 id="_variant">3.8. Variant</h3><div style="clear:left"></div>
<div class="paragraph"><p>The <em>Variant</em> type can be used to create own variant objects.
This type can store all the POD types and pointers to such types.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">int</span> myint <span style="color: #990000">=</span> <span style="color: #993399">5</span><span style="color: #990000">;</span>
DBMS<span style="color: #990000">::</span>Variant <span style="font-weight: bold"><span style="color: #000000">var</span></span><span style="color: #990000">(&amp;</span>myint<span style="color: #990000">);</span>
var<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setInt</span></span><span style="color: #990000">(</span><span style="color: #993399">10</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #000000">assert</span></span><span style="color: #990000">(</span>myint <span style="color: #990000">==</span> <span style="color: #993399">10</span><span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">// myint was changed through setInt()</span></span></tt></pre></div></div>
<h3 id="_columndesc">3.9. ColumnDesc</h3><div style="clear:left"></div>
<div class="paragraph"><p>TODO</p></div>
<h3 id="_blob">3.10. Blob</h3><div style="clear:left"></div>
<div class="paragraph"><p>TODO</p></div>
<h3 id="_memo">3.11. Memo</h3><div style="clear:left"></div>
<div class="paragraph"><p>TODO</p></div>
</div>
<h2 id="_diagnostic_and_error_handling">4. Diagnostic and error handling</h2>
<div class="sectionbody">
<div class="paragraph"><p>Each handle (Environment, Connection and Statement) logs warnings and errors
as a diagnostic record to an internal buffer. If a buffer reaches DBWTL_DIAG_SIZE,
older records are overriden (it works like a circular buffer).</p></div>
<div class="paragraph"><p>With <em>diagAvail()</em> you can check if there are any diagnostic records available and
with <em>fetchDiag()</em> you can fetch them which moves an internal cursor to the next record.</p></div>
<div class="paragraph"><p>If an error occours, the DBWTL performs two steps: all information about
the error are collected and written to a diagnostic record, and second, a SQLSTATE
exception with a copy of the diagnostic record is thrown.</p></div>
<div class="paragraph"><p>Hints and warnings are just logged, no exception is raised.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>dbc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">diagAvail</span></span><span style="color: #990000">())</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> DBMS<span style="color: #990000">::</span>Diag <span style="color: #990000">&amp;</span>diag <span style="color: #990000">=</span> dbc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">fetchDiag</span></span><span style="color: #990000">();</span>
    <span style="font-style: italic"><span style="color: #9A1900">// print information</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<h3 id="_exception_handling">4.1. Exception handling</h3><div style="clear:left"></div>
<div class="paragraph"><p>There are two categories of exceptions implemented in DBWTL.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Engine exceptions
</dt>
<dd>
<p>
        Exceptions inside the DBWTL or DAL code like unknown driver strings,
        reading NULL values and so on.
</p>
</dd>
<dt class="hdlist1">
SQLSTATE exceptions
</dt>
<dd>
<p>
        Exceptions for SQLSTATEs which are classified as errors, for example
        SQL syntax erros, constraint violations or authentification errors.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>There are only a small set of engine errors:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>ex::exception</em>: Base class for exceptions
</p>
</li>
<li>
<p>
<em>ex::convert_error</em>: A variant value could not be converted to the requested type.
</p>
</li>
<li>
<p>
<em>ex::null_value</em>: A variant value is set to NULL and you have tried to read the value
</p>
</li>
<li>
<p>
<em>ex::engine_error</em>: Base class for all exceptions raised in DAL code
</p>
</li>
<li>
<p>
<em>ex::sqlstate_exception</em>: Base class for all SQLSATE error conditions
</p>
</li>
<li>
<p>
<em>ex::not_found</em>: Raised if you have requested a column or parameter which does not exists
</p>
</li>
<li>
<p>
<em>ex::charset_error</em>: The source string could not be converted to the requested charset.
</p>
</li>
<li>
<p>
<em>ex::read_only</em>: Raised if you try to write to a read-only variant
</p>
</li>
<li>
<p>
<em>ex::missing_function</em>: A required function in the external driver library could not be found
</p>
</li>
<li>
<p>
<em>ex::engine_busy</em>: Raised if the engine is busy and your request could not be handled
</p>
</li>
</ul></div>
<div class="paragraph"><p>The SQLSTATE exceptions are far more complex. The list of SQLSTATE exceptions
you can catch depends on the selected engine. Each engine defines their own
list of supported ISO 9075 SQLSATE exceptions (and maybe engine-dependend custom SQLSTATES).
Only the generic engine defines the full set of ISO SQLSTATE error codes, specific
engines defines only thoose where are supported (plus their own states).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DBMS<span style="color: #990000">::</span>Statement <span style="font-weight: bold"><span style="color: #000000">stmt</span></span><span style="color: #990000">(</span>dbc<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span>
<span style="color: #FF0000">{</span>
        stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">prepare</span></span><span style="color: #990000">(</span>L<span style="color: #FF0000">"INSERT INTO customers VALUES(1, 'Dave Miller');"</span><span style="color: #990000">);</span>
        stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span>DBMS<span style="color: #990000">::</span>SQLSTATE_23000 <span style="color: #990000">&amp;</span>state<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Constraint violation"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span>DBMS<span style="color: #990000">::</span>SQLSTATE_22000 <span style="color: #990000">&amp;</span>state<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"General data exception or other 22xxx state"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span>DBMS<span style="color: #990000">::</span>SQLSTATE_42000 <span style="color: #990000">&amp;</span>state<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Syntax error or access violation"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span>ex<span style="color: #990000">::</span>engine_error <span style="color: #990000">&amp;</span>err<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        std<span style="color: #990000">::</span>cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Other errors"</span> <span style="color: #990000">&lt;&lt;</span> std<span style="color: #990000">::</span>endl<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>A SQLSTATE subclass (last 3 chars) is derived from the SQLSTATE class (first
2 chars) which makes it possible to catch a specific subclass SQLSTATE or all
subclasses by catching the class (e.g. SQLSTATE_22000).</p></div>
<div class="paragraph"><p>An engine can define additional SQLSTATES which can be catched by
the same way as regular ISO SQLSTATEs. The only exception is when you are
using the generic engine: only the ISO SQLSTATEs are defined.
If a specific engine defines for example SQLSTATE_XYZ01, you can catch them
only with ex::sqlstate_error which is the base class for all SQLSTATE exceptions.
Inside the exception handler you can fetch the SQLSTATE as a string to make
your decisions:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DBMS<span style="color: #990000">::</span>Statement <span style="font-weight: bold"><span style="color: #000000">stmt</span></span><span style="color: #990000">(</span>dbc<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span>
<span style="color: #FF0000">{</span>
        stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">prepare</span></span><span style="color: #990000">(</span>L<span style="color: #FF0000">"INSERT INTO customers VALUES(1, 'Dave Miller');"</span><span style="color: #990000">);</span>
        stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span>DBMS<span style="color: #990000">::</span>SQLSTATE_42000 <span style="color: #990000">&amp;</span>state<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// catched ISO defined SQLSTATE</span></span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span>ex<span style="color: #990000">::</span>sqlstate_error <span style="color: #990000">&amp;</span>state<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// catched engine specific SQLSTATE</span></span>
        std<span style="color: #990000">::</span>string s <span style="color: #990000">=</span> state<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">diag</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">sqlstate</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">asStr</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ASCII"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>s<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">compare</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"XYZ01"</span><span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
        <span style="color: #FF0000">{</span>
                <span style="font-style: italic"><span style="color: #9A1900">// handle XYZ001</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>s<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">compare</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ZZZ55"</span><span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span>
        <span style="color: #FF0000">{</span>
                <span style="font-style: italic"><span style="color: #9A1900">// handle ZZZ55</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="color: #FF0000">{</span>
                <span style="font-style: italic"><span style="color: #9A1900">// other states</span></span>
        <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>This provides a powerful method if you want to use the generic layer, but also
have to handle engine specific SQLSTATEs.</p></div>
</div>
<h2 id="_api_reference">5. API Reference</h2>
<div class="sectionbody">
<div class="paragraph"><p>This chapter is a reference for the DBWTL classes, types and methods,
including the syntax, method arguments and examples of use.</p></div>
<h3 id="_dbms_environment">5.1. DBMS::Environment</h3><div style="clear:left"></div>
<div class="paragraph"><p>Handle for Statement.</p></div>
<h3 id="_dbms_connection">5.2. DBMS::Connection</h3><div style="clear:left"></div>
<div class="paragraph"><p>Handle for Statement.</p></div>
<h3 id="_dbms_statement">5.3. DBMS::Statement</h3><div style="clear:left"></div>
<div class="paragraph"><p>Handle for Statement.</p></div>
<h4 id="_bind">5.3.1. bind()</h4>
<div class="paragraph"><p>Binds a value or a pointer to a value to a parameter in a prepared
SQL query.</p></div>
<h5 id="_syntax">Syntax</h5>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> Stmt<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span>size_t number<span style="color: #990000">,</span> DBMS<span style="color: #990000">::</span>Variant value<span style="color: #990000">);</span>
<span style="color: #009900">void</span> Stmt<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span>size_t number<span style="color: #990000">,</span> dal<span style="color: #990000">::</span>IVariant<span style="color: #990000">*</span> value<span style="color: #990000">);</span>
<span style="color: #009900">void</span> Stmt<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span>size_t number<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> dal<span style="color: #990000">::</span>IVariant<span style="color: #990000">*</span> value<span style="color: #990000">);</span></tt></pre></div></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="22%" />
<col width="22%" />
<col width="55%" />
<thead>
<tr>
<th align="left" valign="top">Parameter     </th>
<th align="left" valign="top"> Type               </th>
<th align="left" valign="top"> Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><em>number</em></p></td>
<td align="left" valign="top"><p class="table">size_t</p></td>
<td align="left" valign="top"><p class="table">Number of the parameter (starts at 1)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><em>value</em></p></td>
<td align="left" valign="top"><p class="table">dal::Variant</p></td>
<td align="left" valign="top"><p class="table">Variant value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Output parameters</p></div>
<h5 id="_description">Description</h5>
<div class="paragraph"><p>bind() passes data to parameters in a SQL query.</p></div>
<h5 id="_return_value">Return Value</h5>
<div class="paragraph"><p>No return value.</p></div>
<h5 id="_exceptions">Exceptions</h5>
<div class="dlist"><dl>
<dt class="hdlist1">
not_found
</dt>
<dd>
<p>
is thrown when the <em>number</em> argument is out of range.
</p>
</dd>
</dl></div>
<h5 id="_examples">Examples</h5>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>DBMS<span style="color: #990000">::</span>Stmt <span style="font-weight: bold"><span style="color: #000000">stmt</span></span><span style="color: #990000">(</span>dbc<span style="color: #990000">);</span>
stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">prepare</span></span><span style="color: #990000">(</span>L<span style="color: #FF0000">"SELECT * FROM x WHERE a = ? and b = ?;"</span><span style="color: #990000">);</span>
<span style="color: #009900">int</span> valA <span style="color: #990000">=</span> <span style="color: #993399">4</span><span style="color: #990000">;</span>
std<span style="color: #990000">::</span>wstring valB <span style="color: #990000">=</span> L<span style="color: #FF0000">"data"</span><span style="color: #990000">;</span>
stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> valA<span style="color: #990000">);</span>
stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> valB<span style="color: #990000">);</span>
stmt<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<h5 id="_see_also">See Also</h5>
<div class="paragraph"><p>prepare(), execute(), reset()</p></div>
<h3 id="_dbms_resultset">5.4. DBMS::Resultset</h3><div style="clear:left"></div>
<div class="paragraph"><p>Handle for Statement.</p></div>
<h3 id="_dbms_cachedresultset">5.5. DBMS::CachedResultset</h3><div style="clear:left"></div>
<div class="paragraph"><p>Handle for Statement.</p></div>
<h3 id="_dbms_columndesc">5.6. DBMS::ColumnDesc</h3><div style="clear:left"></div>
<div class="paragraph"><p>Handle for Statement.</p></div>
<h3 id="_dbms_diag">5.7. DBMS::Diag</h3><div style="clear:left"></div>
<div class="paragraph"><p>Handle for Statement.</p></div>
</div>
<h2 id="_supported_systems">6. Supported systems</h2>
<div class="sectionbody">
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="11%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
<tbody>
<tr>
<td align="center" valign="top"><p class="table">DBMS</p></td>
<td align="left" valign="top"><p class="table">Version</p></td>
<td align="left" valign="top"><p class="table">Status</p></td>
<td align="left" valign="top"><p class="table">Write Support</p></td>
<td align="left" valign="top"><p class="table">Version introduced</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">General ODBC</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">IN PROGRESS</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">PostgreSQL</p></td>
<td align="left" valign="top"><p class="table">&gt;= 8.4</p></td>
<td align="left" valign="top"><p class="table">IN PROGRESS</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table">0.1.2</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">SQLite</p></td>
<td align="left" valign="top"><p class="table">&gt;= 3.6.0</p></td>
<td align="left" valign="top"><p class="table">IN PROGRESS</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table">0.1.0</p></td>
</tr>
</tbody>
</table>
</div>
<h3 id="_drivers_implemented_as_sda_connector">6.1. Drivers implemented as SDA connector</h3><div style="clear:left"></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="11%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
<tbody>
<tr>
<td align="center" valign="top"><p class="table">DBMS</p></td>
<td align="left" valign="top"><p class="table">Version</p></td>
<td align="left" valign="top"><p class="table">Status</p></td>
<td align="left" valign="top"><p class="table">Write Support</p></td>
<td align="left" valign="top"><p class="table">Version introduced</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">Btrieve</p></td>
<td align="left" valign="top"><p class="table">&#8656; 6.15</p></td>
<td align="left" valign="top"><p class="table">IN PROGRESS</p></td>
<td align="left" valign="top"><p class="table">No</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">DBase</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">PLANNED</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">Paradox</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">PLANNED</p></td>
<td align="left" valign="top"><p class="table">Yes</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">Superbase</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">IN PROGRESS</p></td>
<td align="left" valign="top"><p class="table">No</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">TopSpeed</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">IN PROGRESS</p></td>
<td align="left" valign="top"><p class="table">No</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="_copying">7. COPYING</h2>
<div class="sectionbody">
<div class="paragraph"><p>Copyright (C) 2008-2010 Daniel Vogelbacher.
Free use of this software is
granted under the terms of the BSD License.</p></div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2010-09-25 23:52:14 CEST
</div>
</div>
</body>
</html>
